# PR Title Validation Workflow
#
# Validates that PR titles follow Conventional Commits format.
# This is important because we use squash merges, so the PR title
# becomes the commit message and determines version bumps.
#
# See: https://www.conventionalcommits.org/

name: PR Title

on:
  pull_request:
    types: [opened, edited, synchronize]

# Minimal permissions
permissions:
  pull-requests: read

jobs:
  validate:
    name: Validate PR Title
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: Validate Conventional Commits format
        env:
          PR_TITLE: ${{ github.event.pull_request.title }}
        run: |
          # Conventional Commits pattern
          # Format: type(optional-scope): description
          # Types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert
          PATTERN='^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\([a-z0-9-]+\))?\!?: .{1,72}$'
          
          if [[ ! "$PR_TITLE" =~ $PATTERN ]]; then
            echo "ERROR: PR title does not follow Conventional Commits format"
            echo ""
            echo "Expected format: <type>(<scope>): <description>"
            echo ""
            echo "Valid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert"
            echo ""
            echo "Examples:"
            echo "  feat(auth): add OAuth2 login support"
            echo "  fix: resolve null pointer in user lookup"
            echo "  ci: update GitHub Actions"
            echo ""
            echo "Your title: $PR_TITLE"
            exit 1
          fi
          
          echo "PR title is valid: $PR_TITLE"
